# 用户需求分析 - 用户故事 (User Stories)

> **项目名称**: 智能体创作平台  
> **版本**: v1.0  
> **编写日期**: 2025-11-19  
> **编写目的**: 通过用户故事明确系统需求，指导数据库设计和API开发

---

## 目录
1. [优先级 P0 (必须实现)](#1-优先级-p0-必须实现--mvp核心功能)
2. [优先级 P1 (重要功能)](#2-优先级-p1-重要功能)
3. [优先级 P2 (增强功能)](#3-优先级-p2-增强功能)
4. [用户故事依赖关系图](#4-用户故事依赖关系图)
5. [用户故事总结](#5-用户故事总结)
6. [需求评审结论](#6-需求评审结论)

---

## 1. 优先级 P0 (必须实现 / MVP核心功能)

### US-001: 创建智能体
* **估算工作量**: 3 故事点

* **依赖关系**: 无

* **涉及模块**: 智能体管理模块

* **相关表**: `agent`

* **用户故事**:
    
    > **作为** 用户  
    > **我想要** 创建一个新的智能体  
    > **以便于** 使用AI助手完成特定任务
    
* **详细描述**:
    用户首次使用系统时，需要创建自己的智能体。智能体是系统的核心实体，代表一个AI助手。用户需要为智能体设置名称、描述、系统提示词（定义AI的角色和行为）、选择AI模型（如DeepSeek、豆包等）。创建后的智能体处于草稿状态，可以继续配置知识库、工作流等高级功能。
    
* **验收标准**:
    1.  **给定** 用户已登录系统
    2.  **当** 用户点击"创建智能体"按钮
    3.  **那么** 系统显示智能体创建表单
    4.  **当** 用户填写以下信息并提交:
        - 名称（必填，1-100字符）
        - 描述（可选，最多500字符）
        - 系统提示词（必填，定义AI角色）
        - 用户提示词模板（可选，用于动态插入变量）
        - 模型配置（必填，选择AI服务商和模型）
    5.  **那么** 系统执行以下操作:
        - 验证必填字段不为空
        - 在数据库`agent`表中创建新记录
        - 设置状态为`draft`
        - 记录创建时间`created_at`
        - 返回智能体ID和详细信息
    6.  **那么** 前端页面跳转至该智能体的配置详情页
    7.  **那么** 显示成功消息："智能体创建成功"
    8.  **异常情况**:
        - 若名称为空，提示"名称必填"
        - 若系统提示词为空，提示"系统提示词必填"
        - 若模型配置无效，提示"请选择有效的AI模型"
        - 若数据库插入失败，提示"创建失败，请重试"

### US-002: 查看智能体列表
* **估算工作量**: 2 故事点

* **依赖关系**: US-001（需要先有智能体数据）

* **涉及模块**: 智能体管理模块

* **相关表**: `agent`

* **用户故事**:
    > **作为** 用户  
    > **我想要** 查看我创建的所有智能体列表  
    > **以便于** 管理和选择要使用的智能体
    
* **详细描述**:
    用户登录系统后，需要一个集中的页面查看所有创建的智能体。列表应该以清晰、美观的方式展示每个智能体的关键信息，方便用户快速找到目标智能体进行编辑、测试或对话。列表支持按更新时间排序，并区分草稿和已发布状态。
    
* **验收标准**:
    1.  **给定** 用户已登录系统且创建了若干智能体
    2.  **当** 用户访问首页或智能体列表页面（路由：`/agents`）
    3.  **那么** 系统调用`GET /api/agents`接口获取智能体列表
    4.  **那么** 以卡片或表格形式展示所有智能体，每个卡片包含:
        - 智能体名称（加粗显示）
        - 图标或头像（可选）
        - 描述（截断至50字符，hover显示全文）
        - 状态标签（`draft`草稿 / `published`已发布）
        - 更新时间（相对时间，如"2小时前"）
        - 操作按钮（编辑、测试、删除）
    5.  **那么** 点击卡片主体可进入智能体详情/编辑页面
    6.  **那么** 点击"测试"按钮可打开测试对话窗口
    7.  **那么** 列表默认按`updated_at`降序排列（最新更新在前）
    8.  **边界情况**:
        - 若用户尚未创建任何智能体，显示空状态提示："暂无智能体，点击创建第一个智能体"
        - 若数据加载失败，显示错误提示和重试按钮
    9.  **性能要求**:
        - 支持分页加载（每页20条）
        - 支持搜索功能（按名称或描述搜索）

### US-004: 测试智能体 (调试)
* **估算工作量**: 5 故事点

* **依赖关系**: US-001（需要先创建智能体）

* **涉及模块**: 智能体管理模块、AI模型服务模块

* **相关表**: `agent`

* **用户故事**:
    > **作为** 用户  
    > **我想要** 在编辑页面右侧实时测试智能体的回答效果  
    > **以便于** 验证Prompt配置是否正确
    
* **详细描述**:
    用户在配置智能体的系统提示词时，需要实时测试效果以验证配置是否符合预期。系统应该提供一个调试对话窗口，允许用户发送测试消息并查看AI的回复。这个功能不会保存对话历史，仅用于快速验证配置。
    
* **验收标准**:
    1.  **给定** 用户正在编辑智能体页面
    2.  **当** 页面右侧显示测试对话面板
    3.  **当** 用户在输入框输入测试问题（如"你好"）并点击发送
    4.  **那么** 系统执行以下操作:
        - 获取当前编辑中的系统提示词（可能未保存）
        - 获取模型配置（AI服务商、模型名称、温度等参数）
        - 组装完整提示词：`system_prompt + user_input`
        - 调用LLM Service接口（`POST /api/agents/{id}/test`）
        - 显示"正在思考..."加载状态
    5.  **那么** AI返回回复后，在对话面板显示AI的回答
    6.  **那么** 对话历史在当前测试会话中保留（刷新页面后清空）
    7.  **那么** 显示本次调用的耗时和Token消耗（可选）
    8.  **异常情况**:
        - 若系统提示词为空，提示"请先配置系统提示词"
        - 若AI服务调用失败，显示错误信息："AI服务调用失败，请检查API密钥配置"
        - 若网络超时（30秒），提示"请求超时，请重试"
    9.  **边界情况**:
        - 支持测试知识库增强（若配置了知识库，会进行RAG检索）
        - 支持测试工作流（若配置了工作流，会执行工作流逻辑）
        - 用户可以在测试过程中修改提示词并重新测试

### US-006: 上传文档 (知识库核心)
* **估算工作量**: 8 故事点（涉及文件解析与向量化）

* **依赖关系**: US-005（需要先创建知识库）

* **涉及模块**: 知识库模块、向量数据库集成

* **相关表**: `document`, `knowledge_base`

* **用户故事**:
    > **作为** 用户  
    > **我想要** 上传TXT或Markdown文档到知识库  
    > **以便于** 为智能体提供私有领域知识支持
    
* **详细描述**:
    知识库是智能体实现RAG（检索增强生成）的基础。用户需要上传文本文档，系统自动进行分块、向量化处理，并存储到向量数据库中。当智能体回答问题时，会先检索相关文档片段，再结合LLM生成答案。本功能仅支持纯文本格式（TXT、Markdown），以降低实现复杂度。
    
* **验收标准**:
    1.  **给定** 用户已创建知识库并进入知识库详情页
    2.  **当** 用户点击"上传文档"按钮
    3.  **那么** 显示文件选择对话框，限制文件类型为`.txt`和`.md`
    4.  **当** 用户选择有效文件并确认上传
    5.  **那么** 前端调用`POST /api/knowledge-bases/{id}/documents`接口
    6.  **那么** 后端执行以下步骤:
        - 验证文件格式（检查扩展名和MIME类型）
        - 读取文件内容并存储原始文本
        - 在`document`表中创建记录，状态设为`processing`
        - 异步执行文档处理任务:
            - 文本分块（Chunking），默认chunk_size=512, chunk_overlap=50
            - 调用Embedding API（如OpenAI/DeepSeek Embedding）获取向量
            - 将向量存入向量数据库
            - 将chunks和vector_ids保存到`document`表
            - 更新状态为`success`
    7.  **那么** 前端轮询查询文档处理状态，显示进度提示
    8.  **那么** 处理完成后显示成功消息："文档上传成功，已生成XX个文本块"
    9.  **异常情况**:
        - 若文件格式不是`.txt`或`.md`，提示"仅支持TXT和Markdown格式"
        - 若文件大小超过10MB，提示"文件过大，请上传小于10MB的文件"
        - 若文件内容为空，提示"文件内容为空"
        - 若Embedding API调用失败，标记状态为`failed`，提示"向量化处理失败"
        - 若向量数据库存储失败，提示"向量存储失败，请重试"

### US-013: 智能体对话 (发布版)
* **估算工作量**: 5 故事点

* **依赖关系**: US-012（需要先发布智能体）、US-006（可选，使用知识库）、US-009（可选，使用工作流）

* **涉及模块**: 智能体管理模块、知识库模块、工作流引擎、AI模型服务

* **相关表**: `agent`, `knowledge_base`, `workflow`

* **用户故事**:
    > **作为** 用户  
    > **我想要** 与已发布的智能体进行对话  
    > **以便于** 获得AI助手在特定领域的帮助
    
* **详细描述**:
    这是智能体的核心使用场景。用户与已发布的智能体进行多轮对话，智能体会根据配置的系统提示词、知识库、工作流等综合生成回答。系统需要协调多个模块（LLM调用、RAG检索、工作流执行）来提供完整的对话体验。
    
* **验收标准**:
    1.  **给定** 用户访问已发布的智能体（状态为`published`）
    2.  **当** 用户进入对话页面（路由：`/agents/{id}/chat`）
    3.  **那么** 显示对话界面，包含消息历史区和输入框
    4.  **当** 用户输入问题并发送（如"什么是智能体？"）
    5.  **那么** 系统执行以下流程:
        - **Step 1**: 获取智能体配置（system_prompt, model_config, knowledge_base_ids, workflow_id）
        - **Step 2**: 检查是否配置知识库
            - 若配置，执行RAG检索：
                - 将用户问题向量化
                - 从向量数据库检索Top-K相似文档片段（默认K=3）
                - 将检索结果注入到提示词中
        - **Step 3**: 检查是否配置工作流
            - 若配置，执行工作流引擎
            - 按照工作流定义依次执行节点
            - 获取工作流输出结果
        - **Step 4**: 组装最终提示词
            - 系统提示词 + RAG上下文（若有） + 用户输入
        - **Step 5**: 调用LLM Service生成回答
        - **Step 6**: 返回AI回复并显示在对话界面
    6.  **那么** 对话历史保存在前端（可选：保存到后端数据库）
    7.  **那么** 支持多轮对话，保持上下文
    8.  **那么** 显示AI回复的来源（若使用了知识库，显示引用的文档片段）
    9.  **异常情况**:
        - 若智能体状态为`draft`，提示"该智能体尚未发布"
        - 若AI服务调用失败，提示"AI服务暂时不可用"
        - 若知识库检索失败，降级为不使用知识库直接回答
        - 若工作流执行失败，提示"工作流执行失败"并返回错误信息

---

## 2. 优先级 P1 (重要功能)

### US-003: 编辑智能体
* **估算工作量**: 3 故事点

* **依赖关系**: US-001（需要先创建智能体）

* **涉及模块**: 智能体管理模块

* **相关表**: `agent`

* **用户故事**:
    > **作为** 用户  
    > **我想要** 编辑已创建的智能体配置  
    > **以便于** 更新智能体的提示词、关联的知识库和工作流
    
* **详细描述**:
    用户在使用过程中可能需要优化智能体的配置，包括调整提示词、更换AI模型、添加知识库、配置工作流等。编辑功能应该保留原有数据，仅更新用户修改的字段。
    
* **验收标准**:
    1.  **给定** 用户在智能体列表页面
    2.  **当** 用户点击某个智能体的"编辑"按钮
    3.  **那么** 系统跳转到编辑页面，显示当前配置
    4.  **当** 用户修改以下任意字段并保存:
        - 名称、描述
        - 系统提示词、用户提示词模板
        - 模型配置（AI服务商、模型、温度、最大Token等）
        - 关联的知识库ID列表（支持多选）
        - 关联的工作流ID（单选）
        - 关联的插件ID列表（支持多选）
    5.  **那么** 系统调用`PUT /api/agents/{id}`接口更新数据
    6.  **那么** 更新`updated_at`字段为当前时间
    7.  **那么** 显示成功消息："智能体更新成功"
    8.  **异常情况**:
        - 若修改后名称为空，提示"名称必填"
        - 若知识库ID不存在，提示"选择的知识库不存在"
        - 若工作流ID不存在，提示"选择的工作流不存在"

### US-005: 创建知识库
* **估算工作量**: 2 故事点

* **依赖关系**: 无

* **涉及模块**: 知识库模块

* **相关表**: `knowledge_base`

* **用户故事**:
    > **作为** 用户  
    > **我想要** 创建一个新的知识库  
    > **以便于** 为不同的智能体提供专业领域知识
    
* **详细描述**:
    知识库是文档的容器，用户可以为不同的业务场景创建多个知识库（如"产品文档库"、"技术FAQ库"）。创建知识库仅需设置元数据，后续再上传文档。
    
* **验收标准**:
    1.  **给定** 用户已登录系统
    2.  **当** 用户点击"创建知识库"按钮
    3.  **那么** 显示创建表单
    4.  **当** 用户填写以下信息并提交:
        - 名称（必填，1-100字符）
        - 描述（可选，最多500字符）
        - 分块大小（默认512）
        - 分块重叠（默认50）
    5.  **那么** 系统在`knowledge_base`表中创建记录
    6.  **那么** 跳转到知识库详情页，提示"知识库创建成功，可以开始上传文档"
    7.  **异常情况**:
        - 若名称为空，提示"名称必填"
        - 若chunk_size不在[100, 2000]范围内，提示"分块大小应在100-2000之间"

### US-007: 查看知识库文档
* **估算工作量**: 3 故事点

* **依赖关系**: US-006（需要先上传文档）

* **涉及模块**: 知识库模块

* **相关表**: `document`, `knowledge_base`

* **用户故事**:
    > **作为** 用户  
    > **我想要** 查看知识库中已上传的文档列表  
    > **以便于** 了解知识库的内容和处理状态
    
* **详细描述**:
    用户需要一个页面查看知识库中的所有文档，包括文档名称、上传时间、处理状态（处理中、成功、失败）、分块数量等信息。用户可以下载原始文档或删除文档。
    
* **验收标准**:
    1.  **给定** 用户进入知识库详情页
    2.  **那么** 显示该知识库的基本信息和文档列表
    3.  **那么** 文档列表以表格形式展示，包含列:
        - 文件名
        - 文件大小（可选）
        - 上传时间
        - 处理状态（pending/processing/success/failed，带颜色标签）
        - 分块数量（处理成功后显示）
        - 操作按钮（查看、下载、删除）
    4.  **那么** 支持按状态筛选（全部/成功/失败）
    5.  **当** 用户点击"查看"按钮
    6.  **那么** 显示文档内容和分块详情
    7.  **当** 用户点击"删除"按钮
    8.  **那么** 弹出确认对话框
    9.  **当** 用户确认删除
    10. **那么** 系统删除数据库记录和向量数据，刷新列表

### US-008: 创建工作流 (可视化)
* **估算工作量**: 13 故事点（前端可视化难度大）

* **依赖关系**: 无

* **涉及模块**: 工作流引擎模块

* **相关表**: `workflow`

* **用户故事**:
    > **作为** 用户  
    > **我想要** 通过可视化编辑器创建工作流  
    > **以便于** 定义智能体的复杂执行逻辑
    
* **详细描述**:
    工作流允许用户编排多个步骤（LLM调用、插件执行、条件判断等），实现复杂的业务逻辑。使用拖拽式可视化编辑器降低使用门槛。工作流定义保存为JSON格式，符合规范标准。
    
* **验收标准**:
    1.  **给定** 用户已登录系统
    2.  **当** 用户点击"创建工作流"按钮
    3.  **那么** 打开工作流可视化编辑器（画布）
    4.  **那么** 左侧显示节点面板，包含以下节点类型:
        - 开始节点（必须，且只能有一个）
        - 结束节点（必须，可以有多个）
        - LLM节点（调用AI模型）
        - 插件节点（调用自定义插件）
        - 条件节点（条件分支，if-else）
        - 变量节点（设置变量，可选）
    5.  **当** 用户拖拽节点到画布并连线
    6.  **当** 用户双击节点配置参数（如LLM节点配置提示词模板）
    7.  **当** 用户点击"保存"按钮并填写工作流名称和描述
    8.  **那么** 前端将画布数据转换为JSON格式:
        ```json
        {
          "nodes": [
            {"id": "node1", "type": "start", "config": {}},
            {"id": "node2", "type": "llm", "config": {"prompt": "..."}}
          ],
          "edges": [
            {"source": "node1", "target": "node2"}
          ]
        }
        ```
    9.  **那么** 调用`POST /api/workflows`接口保存
    10. **那么** 后端验证工作流合法性:
        - 必须有开始节点和结束节点
        - 不能有循环（DAG验证）
        - 所有节点必须连接
        - 条件节点必须有两个分支
    11. **那么** 验证通过后保存到数据库，返回工作流ID
    12. **异常情况**:
        - 若缺少开始节点，提示"必须有一个开始节点"
        - 若存在循环，提示"工作流不能有循环"
        - 若有孤立节点，提示"所有节点必须连接"

### US-009: 执行工作流
* **估算工作量**: 8 故事点（后端引擎逻辑）

* **依赖关系**: US-008（需要先创建工作流）

* **涉及模块**: 工作流引擎模块

* **相关表**: `workflow`

* **用户故事**:
    > **作为** 用户  
    > **我想要** 执行已创建的工作流  
    > **以便于** 测试工作流的执行效果
    
* **详细描述**:
    工作流执行引擎负责解析工作流JSON定义，按照拓扑顺序依次执行节点。支持顺序执行、条件分支、并行执行（可选）。执行过程异步进行，前端通过轮询获取状态。
    
* **验收标准**:
    1.  **给定** 用户已创建工作流
    2.  **当** 用户在工作流详情页点击"执行"按钮
    3.  **当** 用户输入工作流初始参数（如input变量）
    4.  **那么** 调用`POST /api/workflows/{id}/execute`接口
    5.  **那么** 后端返回执行ID和初始状态`pending`
    6.  **那么** 后端异步执行工作流:
        - 解析nodes和edges，构建执行图
        - 按拓扑顺序执行节点
        - 每个节点执行完成后，将输出传递给下一个节点
        - 条件节点根据判断结果选择分支
        - 遇到错误时标记状态为`failed`
    7.  **那么** 前端轮询`GET /api/workflows/executions/{id}/status`接口
    8.  **那么** 显示执行状态：
        - `pending`（等待执行）
        - `running`（执行中，显示当前节点）
        - `completed`（执行成功，显示结果）
        - `failed`（执行失败，显示错误信息）
    9.  **那么** 执行完成后显示结果和每个节点的输出
    10. **异常情况**:
        - 若工作流定义无效，返回`failed`状态
        - 若LLM调用失败，标记节点为失败并停止执行
        - 若插件调用失败，根据配置决定是否继续

---

## 3. 优先级 P2 (增强功能)

### US-010: 注册插件
* **估算工作量**: 3 故事点

* **依赖关系**: 无

* **涉及模块**: 插件系统模块

* **相关表**: `plugin`

* **用户故事**:
    > **作为** 用户  
    > **我想要** 注册一个自定义插件  
    > **以便于** 扩展智能体的功能（如调用外部API）
    
* **详细描述**:
    插件系统允许用户集成外部API服务，扩展智能体的能力。用户需要上传符合OpenAPI 3.0规范的JSON文件，系统解析后即可在工作流中使用该插件。
    
* **验收标准**:
    1.  **给定** 用户已登录系统
    2.  **当** 用户点击"注册插件"按钮
    3.  **那么** 显示插件注册表单
    4.  **当** 用户填写以下信息并提交:
        - 插件名称（必填）
        - 描述（可选）
        - 类型（内置builtin / 自定义custom）
        - OpenAPI规范JSON文件（上传或粘贴文本）
        - 配置信息（如API密钥、Base URL等）
    5.  **那么** 系统验证OpenAPI规范格式:
        - 必须符合OpenAPI 3.0标准
        - 必须包含`info`, `paths`, `servers`字段
        - 至少定义一个API端点
    6.  **那么** 验证通过后保存到`plugin`表，状态默认为`disabled`
    7.  **那么** 显示成功消息："插件注册成功，可在插件管理页面启用"
    8.  **异常情况**:
        - 若OpenAPI格式不正确，提示"OpenAPI规范格式错误"
        - 若插件名称重复，提示"插件名称已存在"

### US-011: 启用/禁用插件
* **估算工作量**: 1 故事点

* **依赖关系**: US-010（需要先注册插件）

* **涉及模块**: 插件系统模块

* **相关表**: `plugin`

* **用户故事**:
    > **作为** 用户  
    > **我想要** 启用或禁用已注册的插件  
    > **以便于** 控制插件的可用性
    
* **详细描述**:
    用户可能需要临时禁用某些插件（如外部API服务维护期间），或重新启用已禁用的插件。状态切换是简单的操作，不影响其他数据。
    
* **验收标准**:
    1.  **给定** 用户在插件管理页面
    2.  **当** 用户点击插件的"启用"或"禁用"按钮
    3.  **那么** 系统调用`PUT /api/plugins/{id}/status`接口
    4.  **那么** 更新`status`字段（`enabled` ↔ `disabled`）
    5.  **那么** 刷新列表，显示新状态
    6.  **那么** 显示提示消息："插件已启用/禁用"
    7.  **边界情况**:
        - 禁用的插件不能在工作流中使用
        - 若工作流中正在使用该插件，禁用时显示警告

### US-012: 发布智能体
* **估算工作量**: 2 故事点

* **依赖关系**: US-001（需要先创建智能体）

* **涉及模块**: 智能体管理模块

* **相关表**: `agent`

* **用户故事**:
    > **作为** 用户  
    > **我想要** 发布已创建的智能体  
    > **以便于** 让智能体可以正式对外使用
    
* **详细描述**:
    智能体创建后处于草稿状态，需要完成配置并通过验证后才能发布。发布操作确保智能体的基本配置完整且可用。
    
* **验收标准**:
    1.  **给定** 用户已创建智能体（状态为`draft`）
    2.  **当** 用户在智能体详情页点击"发布"按钮
    3.  **那么** 系统执行配置完整性检查:
        - 名称不为空
        - 系统提示词不为空
        - 模型配置有效（至少选择一个AI模型）
        - 若关联知识库，验证知识库存在且有文档
        - 若关联工作流，验证工作流存在且有效
    4.  **那么** 验证通过后，调用`POST /api/agents/{id}/publish`接口
    5.  **那么** 更新`status`字段从`draft`改为`published`
    6.  **那么** 更新`updated_at`字段
    7.  **那么** 显示成功消息："智能体发布成功"
    8.  **那么** 页面显示"已发布"状态标签，并启用"对话"按钮
    9.  **异常情况**:
        - 若名称为空，提示"请填写智能体名称"
        - 若系统提示词为空，提示"请配置系统提示词"
        - 若模型配置无效，提示"请选择有效的AI模型"
        - 若关联的知识库不存在，提示"关联的知识库不存在"
    10. **边界情况**:
        - 已发布的智能体可以重新编辑，编辑后仍保持已发布状态
        - 支持"取消发布"功能（将状态改回`draft`）

---

## 4. 用户故事依赖关系图

```
US-001 (创建智能体)
  ├─→ US-002 (查看智能体列表)
  ├─→ US-003 (编辑智能体)
  ├─→ US-004 (测试智能体)
  └─→ US-012 (发布智能体)
        └─→ US-013 (智能体对话)

US-005 (创建知识库)
  └─→ US-006 (上传文档)
        └─→ US-007 (查看知识库文档)

US-008 (创建工作流)
  └─→ US-009 (执行工作流)

US-010 (注册插件)
  └─→ US-011 (启用/禁用插件)

依赖关系说明：
- US-013依赖US-012（必须先发布才能对话）
- US-013可选依赖US-006（使用知识库增强）
- US-013可选依赖US-009（使用工作流）
- US-003可选关联US-005和US-008（编辑时关联知识库和工作流）
```

---

## 5. 用户故事总结

### 5.1 总体统计
| 优先级 | 用户故事数量 | 总故事点 | 占比 |
|--------|------------|---------|------|
| P0     | 5          | 23      | 43%  |
| P1     | 5          | 29      | 54%  |
| P2     | 3          | 6       | 3%   |
| **总计** | **13**   | **58**  | **100%** |

### 5.2 模块分布
| 模块 | 用户故事 | 故事点 |
|------|---------|--------|
| 智能体管理模块 | US-001, US-002, US-003, US-004, US-012, US-013 | 20 |
| 知识库模块 | US-005, US-006, US-007 | 13 |
| 工作流引擎模块 | US-008, US-009 | 21 |
| 插件系统模块 | US-010, US-011 | 4 |

### 5.3 涉及数据库表
| 表名 | 相关用户故事 | 说明 |
|------|------------|------|
| `agent` | US-001, US-002, US-003, US-004, US-012, US-013 | 智能体核心表 |
| `knowledge_base` | US-005, US-013 | 知识库元数据 |
| `document` | US-006, US-007 | 文档存储表 |
| `workflow` | US-008, US-009, US-013 | 工作流定义表 |
| `plugin` | US-010, US-011 | 插件注册表 |

---

## 6. 需求评审结论

### 6.1 完整性评估
✅ **覆盖系统基本功能**:
- 智能体的完整生命周期（创建、编辑、测试、发布、对话）
- 知识库的文档管理（创建、上传、查看）
- 工作流的可视化编排和执行
- 插件的注册和管理

✅ **涵盖核心用户场景**:
- 用户可以零代码创建AI助手
- 用户可以上传私有知识增强AI能力
- 用户可以通过工作流实现复杂逻辑
- 用户可以集成外部API扩展功能

### 6.2 合理性评估
✅ **用户故事符合INVEST原则**:
- **Independent（独立）**: 每个用户故事可独立实现
- **Negotiable（可协商）**: 验收标准可根据实际情况调整
- **Valuable（有价值）**: 每个故事都解决实际用户需求
- **Estimable（可估算）**: 提供了故事点估算
- **Small（小）**: US-008较大（13点），但因其复杂性合理
- **Testable（可测试）**: 提供了详细的验收标准

✅ **依赖关系清晰**:
- 明确标注了每个用户故事的依赖关系
- 支持按优先级和依赖关系安排开发顺序

### 6.3 可能遗漏的用户故事（可选扩展）
以下用户故事在当前阶段未包含，可在后续迭代中考虑：

1. **US-014: 删除智能体**（当前仅支持创建和编辑）
2. **US-015: 对话历史管理**（保存和查看历史对话）
3. **US-016: 智能体分享**（生成分享链接）
4. **US-017: 系统配置管理**（API密钥配置、模型管理）
5. **US-018: 批量操作**（批量删除文档、批量导入插件）
6. **US-019: 数据统计**（Token消耗统计、使用次数统计）

### 6.4 评审结论
✅ **通过评审**

- 用户故事覆盖了智能体创作平台的核心功能
- 优先级划分合理，符合MVP开发原则
- 验收标准详细，可作为开发和测试依据
- 依赖关系清晰，支持迭代开发
- 建议按照优先级（P0 → P1 → P2）顺序开发

